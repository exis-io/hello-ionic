if("undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports){var jsriffle=require("jsRiffle");module.exports="ngRiffle"}!function(){"use strict";function a(){var a=void 0,b=["Application","Domain","ModelObject","wait","want"];for(var c in jsRiffle)-1===b.indexOf(c)&&(this[c]=jsRiffle[c]);this.SetDomain=function(b){a=b};var d=this.interceptors=[];return this.$get=["$rootScope","$q","$log","$injector",function(b,c,e,f){function g(a){return function(){var c=a.apply(this,arguments);return b.$apply(),c}}function h(a,b){this.conn=b,this.conn?this.conn=b.Subdomain(a):this.conn=jsRiffle.Domain(a),this.conn.onJoin=m,this.conn.onLeave=n}var i,j=c.defer(),k=j.promise,l=[];angular.forEach(d,function(a){l.unshift(angular.isString(a)?f.get(a):f.invoke(a))});var m=g(function(){b.$broadcast("$riffle.open"),j.resolve()}),n=g(function(a,d){e.debug("Connection Closed: ",a,d),j=c.defer(),k=j.promise,b.$broadcast("$riffle.leave",{reason:a,details:d})});i=new h(a),i.want=jsRiffle.want,i.wait=jsRiffle.wait,i.ModelObject=jsRiffle.ModelObject;var o=function(a,b,d){var f=function(c){return{result:c,type:a,args:b}},g=function(d){return e.error("$riffle error",{type:a,arguments:b,error:d}),c.reject({error:d,type:a,args:b})},h=k.then(function(){return d()}),i=[f,g];for(angular.forEach(l,function(b){(b[a+"Response"]||b[a+"ResponseError"])&&i.push(b[a+"Response"],b[a+"ResponseError"])}),i.push(function(a){return a.result},function(a){return c.reject(a.error)});i.length;){var j=i.shift(),m=i.shift();h=h.then(j,m)}return h};return h.prototype.subdomains={},h.prototype.join=function(){this.conn.Join()},h.prototype.leave=function(){this.conn.Leave()},h.prototype.subscribeOnScope=function(a,b,c){var d=this;return this.subscribe(b,c).then(function(){a.$on("$destroy",function(){return d.unsubscribe(b)})})},h.prototype.setToken=function(a){this.conn.SetToken(a)},h.prototype.unsubscribe=function(a){var b=this;return o("unsubscribe",arguments,function(){return b.conn.Unsubscribe(a)})},h.prototype.publish=function(){var a=arguments,b=this;return o("publish",arguments,function(){return b.conn.Publish.apply(b.conn,a)})},h.prototype.register=function(a,b){"function"==typeof b?b=g(b):b.fp=g(b.fp);var c=this;return o("register",arguments,function(){return c.conn.Register(a,b)})},h.prototype.subscribe=function(a,b){"function"==typeof b?b=g(b):b.fp=g(b.fp);var c=this;return o("subscribe",arguments,function(){return c.conn.Subscribe(a,b)})},h.prototype.unregister=function(a){var b=this;return o("unregister",arguments,function(){return b.conn.Unregister(a)})},h.prototype.call=function(){var a=arguments,b=this;return o("call",arguments,function(){return b.conn.Call.apply(b.conn,a)})},h.prototype.subdomain=function(a){var b=new h(a,this.conn);return this.subdomains[a]=b,b},i}],this}angular.module("ngRiffle",[]).provider("$riffle",a)}();